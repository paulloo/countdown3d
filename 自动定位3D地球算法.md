好的，让我们从算法的角度出发，明确如何根据经纬度计算 3D 地球上的坐标。具体算法如下：

### 算法步骤

1. **输入数据**：
   - **纬度（`lat`）**：范围为 -90° 到 90°，表示地球上的纬度。
   - **经度（`lng`）**：范围为 -180° 到 180°，表示地球上的经度。
   - **地球半径（`R`）**：可以选择固定值，通常地球半径为 1 或者你可以设置为具体的模型半径。

2. **转换为弧度**：
   经纬度是以度为单位的，而大多数数学函数（如 `sin`、`cos`）需要的是弧度。你需要将经纬度转换为弧度。转换公式如下：
   - `lat_rad = lat * π / 180`
   - `lng_rad = lng * π / 180`

3. **根据球面坐标公式计算 3D 坐标**：
   通过球坐标系的公式，计算得到对应的 3D 空间中的坐标（`x`, `y`, `z`）。公式如下：
   - `x = R * cos(lat_rad) * cos(lng_rad)`
   - `y = R * cos(lat_rad) * sin(lng_rad)`
   - `z = R * sin(lat_rad)`

4. **输出结果**：
   计算得到的 `x`, `y`, `z` 就是地球表面上对应于给定经纬度的 3D 坐标。

### 具体步骤

1. **规范化经纬度**：
   经度范围应为 [-180, 180]，纬度范围应为 [-90, 90]，需要确保输入经纬度在这个范围内。如果输入经纬度超出了范围，应该进行修正。

2. **坐标转换**：
   使用球坐标系公式将经纬度转换为 3D 坐标。转换时，`lat` 是纬度，`lng` 是经度，`R` 是地球的半径。

3. **3D 坐标计算**：
   通过三角函数（`cos`、`sin`）计算对应的 3D 坐标。

### 伪代码描述

```text
function latLngTo3DCoordinates(lat, lng, radius):
    # 将经纬度转换为弧度
    lat_rad = lat * π / 180
    lng_rad = lng * π / 180
    
    # 计算 3D 坐标
    x = radius * cos(lat_rad) * cos(lng_rad)
    y = radius * cos(lat_rad) * sin(lng_rad)
    z = radius * sin(lat_rad)
    
    return (x, y, z)
```

### 具体实现

以此为基础，你可以在代码中实现这个算法：

1. **`latLngTo3DCoordinates` 函数**：
   - 输入经纬度、半径（可选，默认为 1）。
   - 返回对应的 3D 坐标 `(x, y, z)`。

2. **如何应用**：
   - 获取用户输入的经纬度。
   - 调用 `latLngTo3DCoordinates` 函数计算坐标。
   - 使用 `three.js` 来更新地球模型或标记位置。

### 示例代码

```ts
import * as THREE from 'three';

// 经纬度转3D球面坐标
const latLngTo3DCoords = (lat: number, lng: number, radius: number = 1): THREE.Vector3 => {
  // 将纬度和经度转换为弧度
  const latRad = THREE.MathUtils.degToRad(lat);
  const lngRad = THREE.MathUtils.degToRad(lng);

  // 计算 x, y, z 坐标
  const x = radius * Math.cos(latRad) * Math.cos(lngRad);
  const y = radius * Math.cos(latRad) * Math.sin(lngRad);
  const z = radius * Math.sin(latRad);

  return new THREE.Vector3(x, y, z);
};

// 示例：点击按钮后，根据经纬度更新地球的位置
const updateEarthPosition = (lat: number, lng: number) => {
  // 获取转换后的3D坐标
  const coords = latLngTo3DCoords(lat, lng);

  // 假设你有一个earthRef，表示地球的Mesh对象
  if (earthRef.current) {
    earthRef.current.position.set(coords.x, coords.y, coords.z);  // 设置地球位置
  }

  // 假设你有一个markerRef表示标记位置
  if (markerRef.current) {
    markerRef.current.position.set(coords.x, coords.y, coords.z);  // 设置标记位置
  }
};

// 示例按钮点击事件
const onLocationClick = (lat: number, lng: number) => {
  updateEarthPosition(lat, lng);
};
```

### 解析
- `latLngTo3DCoords` 通过球面坐标公式将经纬度 `(lat, lng)` 转换为 3D 空间坐标 `(x, y, z)`，并返回一个 `THREE.Vector3` 对象。
- 通过 `earthRef.current.position.set(coords.x, coords.y, coords.z)` 设置地球模型的位置。
- 如果你要在地球上标记该位置，可以通过类似的方式设置标记的位置 `markerRef.current.position.set(coords.x, coords.y, coords.z)`。

### 总结
这个算法通过球坐标转换公式将经纬度映射到 3D 空间中的位置，适合用于 Three.js 中的地球模型或任何需要基于经纬度进行 3D 定位的应用。